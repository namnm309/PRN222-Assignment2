@model List<DataAccessLayer.Entities.PricingPolicy>
@{
    ViewData["Title"] = "Qu·∫£n l√Ω gi√° s·ªâ";
    Layout = "_DashboardLayout";
    var summary = ViewBag.Summary as Dictionary<string, decimal>;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">Qu·∫£n l√Ω gi√° s·ªâ</h2>
        <p class="text-muted mb-0">Qu·∫£n l√Ω ch√≠nh s√°ch gi√° v√† chi·∫øt kh·∫•u cho c√°c ƒë·∫°i l√Ω</p>
    </div>
    <div>
        <a asp-action="CreatePolicy" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Th√™m ch√≠nh s√°ch gi√°
        </a>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1 small">T·ªïng ch√≠nh s√°ch</p>
                        <h3 class="mb-0">@((int)(summary?["TotalPolicies"] ?? 0))</h3>
                    </div>
                    <div class="fs-1 text-primary">üìã</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1 small">Gi√° s·ªâ TB</p>
                        <h3 class="mb-0">@((summary?["AverageWholesalePrice"] ?? 0).ToString("N0")) VNƒê</h3>
                    </div>
                    <div class="fs-1 text-success">üí∞</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1 small">Chi·∫øt kh·∫•u TB</p>
                        <h3 class="mb-0 text-warning">@((summary?["AverageDiscountRate"] ?? 0).ToString("F1"))%</h3>
                    </div>
                    <div class="fs-1 text-warning">üè∑Ô∏è</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1 small">C√≥ chi·∫øt kh·∫•u</p>
                        <h3 class="mb-0 text-info">@((int)(summary?["PoliciesWithDiscount"] ?? 0))</h3>
                    </div>
                    <div class="fs-1 text-info">üéØ</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <i class="fas fa-list fa-2x text-primary mb-3"></i>
                <h6 class="mb-2">T·∫•t c·∫£ ch√≠nh s√°ch</h6>
                <a asp-action="Policies" class="btn btn-outline-primary btn-sm">Xem chi ti·∫øt</a>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                <h6 class="mb-2">Ch√≠nh s√°ch hi·ªáu l·ª±c</h6>
                <a asp-action="ActivePolicies" class="btn btn-outline-success btn-sm">Xem hi·ªáu l·ª±c</a>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <i class="fas fa-percentage fa-2x text-warning mb-3"></i>
                <h6 class="mb-2">Ch√≠nh s√°ch chi·∫øt kh·∫•u</h6>
                <a asp-action="DiscountPolicies" class="btn btn-outline-warning btn-sm">Xem chi·∫øt kh·∫•u</a>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <i class="fas fa-calculator fa-2x text-info mb-3"></i>
                <h6 class="mb-2">T√≠nh gi√°</h6>
                <a asp-action="PriceCalculator" class="btn btn-outline-info btn-sm">M√°y t√≠nh gi√°</a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Policies -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Ch√≠nh s√°ch gi√° g·∫ßn ƒë√¢y</h5>
            <a asp-action="Policies" class="btn btn-outline-primary btn-sm">Xem t·∫•t c·∫£</a>
        </div>
    </div>
    <div class="card-body">
        @if (Model != null && Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>S·∫£n ph·∫©m</th>
                            <th>ƒê·∫°i l√Ω/Khu v·ª±c</th>
                            <th>Gi√° s·ªâ</th>
                            <th>Gi√° l·∫ª</th>
                            <th>Chi·∫øt kh·∫•u</th>
                            <th>Lo·∫°i</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Hi·ªáu l·ª±c</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var policy in Model.Take(10))
                        {
                            <tr>
                                <td>
                                    <div>
                                        <strong>@policy.Product?.Name</strong>
                                        <br><small class="text-muted">@policy.Product?.Brand?.Name</small>
                                    </div>
                                </td>
                                <td>
                                    @if (policy.Dealer != null)
                                    {
                                        <div>
                                            <strong>@policy.Dealer.Name</strong>
                                            <br><small class="text-muted">ƒê·∫°i l√Ω</small>
                                        </div>
                                    }
                                    else if (policy.Region != null)
                                    {
                                        <div>
                                            <strong>@policy.Region.Name</strong>
                                            <br><small class="text-muted">Khu v·ª±c</small>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="text-muted">Chung</span>
                                    }
                                </td>
                                <td><strong>@policy.WholesalePrice.ToString("N0") VNƒê</strong></td>
                                <td>@policy.RetailPrice.ToString("N0") VNƒê</td>
                                <td>
                                    @if (policy.DiscountRate > 0)
                                    {
                                        <span class="badge bg-warning text-dark">@policy.DiscountRate.ToString("F1")%</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>
                                    @{
                                        var typeClass = policy.PolicyType switch
                                        {
                                            "VIP" => "bg-warning",
                                            "Bulk" => "bg-info",
                                            "Seasonal" => "bg-success",
                                            _ => "bg-secondary"
                                        };
                                    }
                                    <span class="badge @typeClass">@policy.PolicyType</span>
                                </td>
                                <td>
                                    @{
                                        var statusClass = policy.Status switch
                                        {
                                            "Active" => "bg-success",
                                            "Inactive" => "bg-secondary",
                                            "Expired" => "bg-danger",
                                            _ => "bg-secondary"
                                        };
                                    }
                                    <span class="badge @statusClass">@policy.Status</span>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        @policy.EffectiveDate.ToString("dd/MM/yyyy")
                                        @if (policy.ExpiryDate.HasValue)
                                        {
                                            <br><text>ƒë·∫øn </text>@policy.ExpiryDate.Value.ToString("dd/MM/yyyy")
                                        }
                                    </small>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="text-center py-4">
                <i class="fas fa-tags fa-3x text-muted mb-3"></i>
                <p class="text-muted">Ch∆∞a c√≥ ch√≠nh s√°ch gi√° n√†o</p>
                <a asp-action="CreatePolicy" class="btn btn-primary">T·∫°o ch√≠nh s√°ch ƒë·∫ßu ti√™n</a>
            </div>
        }
    </div>
</div>
