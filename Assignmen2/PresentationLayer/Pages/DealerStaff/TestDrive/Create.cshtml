@page
@model PresentationLayer.Pages.DealerStaff.TestDrive.CreateModel
@{
    Layout = "~/Pages/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Tạo lịch hẹn lái thử";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">
            <i class="fas fa-calendar-plus me-2 text-primary"></i>
            Tạo lịch hẹn lái thử
        </h2>
        <p class="text-muted mb-0">Đăng ký lịch hẹn lái thử xe cho khách hàng</p>
    </div>
    <div>
        <a asp-page="/DealerStaff/TestDrive/Index" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Quay lại
        </a>
    </div>
</div>

<div class="row">
    <div class="col-12 col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <form method="post">
                    <div class="row g-3">
                        <!-- Customer Information -->
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-user me-2"></i>
                                Thông tin khách hàng
                            </h5>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="Input.CustomerName" class="form-label">Tên khách hàng <span class="text-danger">*</span></label>
                            <input asp-for="Input.CustomerName" class="form-control" placeholder="Nhập tên khách hàng">
                            <span asp-validation-for="Input.CustomerName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="Input.CustomerPhone" class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                            <input asp-for="Input.CustomerPhone" class="form-control" placeholder="Nhập số điện thoại">
                            <span asp-validation-for="Input.CustomerPhone" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="Input.CustomerEmail" class="form-label">Email</label>
                            <input asp-for="Input.CustomerEmail" type="email" class="form-control" placeholder="Nhập email khách hàng">
                            <span asp-validation-for="Input.CustomerEmail" class="text-danger"></span>
                        </div>

                        <!-- Vehicle Selection -->
                        <div class="col-12">
                            <h5 class="mb-3 mt-4">
                                <i class="fas fa-car me-2"></i>
                                Chọn xe lái thử
                            </h5>
                        </div>

                        <div class="col-12">
                            <label asp-for="Input.ProductId" class="form-label">Xe lái thử <span class="text-danger">*</span></label>
                            <select asp-for="Input.ProductId" class="form-select">
                                <option value="">-- Chọn xe lái thử --</option>
                                @if (Model.Products != null)
                                {
                                    @foreach (var product in Model.Products)
                                    {
                                        <option value="@product.Id">@product.Name - @product.Brand?.Name (@product.Sku)</option>
                                    }
                                }
                            </select>
                            <span asp-validation-for="Input.ProductId" class="text-danger"></span>
                        </div>

                        <!-- Schedule Information -->
                        <div class="col-12">
                            <h5 class="mb-3 mt-4">
                                <i class="fas fa-clock me-2"></i>
                                Thông tin lịch hẹn
                            </h5>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="Input.ScheduledDate" class="form-label">Ngày hẹn <span class="text-danger">*</span></label>
                            <input asp-for="Input.ScheduledDate" type="date" class="form-control">
                            <span asp-validation-for="Input.ScheduledDate" class="text-danger"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="Input.ScheduledTime" class="form-label">Giờ hẹn <span class="text-danger">*</span></label>
                            <input asp-for="Input.ScheduledTime" type="time" class="form-control">
                            <span asp-validation-for="Input.ScheduledTime" class="text-danger"></span>
                        </div>

                        <div class="col-12">
                            <label asp-for="Input.Notes" class="form-label">Ghi chú</label>
                            <textarea asp-for="Input.Notes" class="form-control" rows="3" placeholder="Ghi chú thêm về lịch hẹn..."></textarea>
                            <span asp-validation-for="Input.Notes" class="text-danger"></span>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="col-12">
                            <hr>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Tạo lịch hẹn
                                </button>
                                <a asp-page="/DealerStaff/TestDrive/Index" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i> Hủy
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <!-- Available Time Slots -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="fas fa-calendar-alt me-2"></i>
                    Khung giờ trống
                </h6>
            </div>
            <div class="card-body">
                <div class="text-muted small mb-3">
                    Chọn ngày để xem khung giờ trống
                </div>
                <div id="availableSlots">
                    <div class="text-center text-muted">
                        <i class="fas fa-calendar-check fa-2x mb-2"></i>
                        <div>Chọn ngày để xem khung giờ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card border-0 shadow-sm mt-3">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Hướng dẫn
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Lịch hẹn phải cách ít nhất 30 phút
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Mỗi lịch hẹn kéo dài 90 phút
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Không được trùng lịch với lịch khác
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check text-success me-2"></i>
                        Hệ thống sẽ gửi thông báo cho khách hàng
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.querySelector('input[name="Input.ScheduledDate"]');
            const timeInput = document.querySelector('input[name="Input.ScheduledTime"]');
            const availableSlots = document.getElementById('availableSlots');

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;

            // Set default time to next hour
            const now = new Date();
            const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
            timeInput.value = nextHour.toTimeString().slice(0, 5);

            // Load available slots when date changes
            dateInput.addEventListener('change', function() {
                if (this.value) {
                    loadAvailableSlots(this.value);
                }
            });

            function loadAvailableSlots(date) {
                // TODO: Implement AJAX call to get available time slots
                // For now, show a placeholder
                availableSlots.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                        <div>Đang tải khung giờ trống...</div>
                    </div>
                `;

                // Simulate loading
                setTimeout(() => {
                    availableSlots.innerHTML = `
                        <div class="text-center text-success">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <div>Ngày ${date} có sẵn</div>
                            <small class="text-muted">Chọn giờ phù hợp</small>
                        </div>
                    `;
                }, 1000);
            }
        });
    </script>
}
