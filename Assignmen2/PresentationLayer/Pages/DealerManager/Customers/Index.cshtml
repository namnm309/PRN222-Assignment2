@page
@model PresentationLayer.Pages.DealerManager.Customers.IndexModel
@{
	Layout = "/Pages/Shared/_DashboardLayout.cshtml";
	ViewData["Title"] = "Quản lý khách hàng";
}

<div class="container-fluid">
	<!-- Header -->
	<div class="d-flex align-items-center justify-content-between mb-4">
		<div>
			<h3 class="mb-1 fw-bold"><i class="fas fa-users me-2 text-primary"></i>Quản lý khách hàng</h3>
			<p class="text-muted mb-0">Danh sách khách hàng và thông tin liên hệ</p>
		</div>
		<a class="btn btn-primary shadow-sm" asp-page="/DealerManager/Customers/Create">
			<i class="fas fa-user-plus me-2"></i>Thêm khách hàng
		</a>
	</div>

	<!-- Search & Filter -->
	<div class="card border-0 shadow-sm mb-4">
		<div class="card-body">
			<form method="get" class="row g-3">
				<div class="col-md-10">
					<div class="input-group">
						<span class="input-group-text bg-white border-end-0">
							<i class="fas fa-search text-muted"></i>
						</span>
						<input class="form-control border-start-0 ps-0" name="Search" value="@Model.Search" 
							   placeholder="Tìm kiếm theo tên, số điện thoại, email..." />
					</div>
				</div>
				<div class="col-md-2">
					<button class="btn btn-primary w-100" type="submit">
						<i class="fas fa-filter me-1"></i>Lọc
					</button>
				</div>
			</form>
		</div>
	</div>

	<!-- KPI Cards -->
	<div class="row g-3 mb-4">
		<div class="col-md-4">
			<div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
				<div class="card-body text-white">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<div class="small opacity-75 mb-2">Tổng khách hàng</div>
							<h2 class="mb-0 fw-bold">@Model.TotalCustomers</h2>
							<div class="small mt-2 opacity-75">
								<i class="fas fa-users me-1"></i>Toàn hệ thống
							</div>
						</div>
						<div class="p-3 bg-white bg-opacity-25 rounded-circle">
							<i class="fas fa-users fs-1"></i>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
				<div class="card-body text-white">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<div class="small opacity-75 mb-2">Khách hàng mới</div>
							<h2 class="mb-0 fw-bold">@Model.NewCustomersThisMonth</h2>
							<div class="small mt-2 opacity-75">
								<i class="fas fa-calendar me-1"></i>Tháng này
							</div>
						</div>
						<div class="p-3 bg-white bg-opacity-25 rounded-circle">
							<i class="fas fa-user-plus fs-1"></i>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
				<div class="card-body text-white">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<div class="small opacity-75 mb-2">Khách hàng hoạt động</div>
							<h2 class="mb-0 fw-bold">@Model.ActiveCustomers</h2>
							<div class="small mt-2 opacity-75">
								<i class="fas fa-check-circle me-1"></i>Đang hoạt động
							</div>
						</div>
						<div class="p-3 bg-white bg-opacity-25 rounded-circle">
							<i class="fas fa-user-check fs-1"></i>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Customer List -->
	<div class="card border-0 shadow-sm">
		<div class="card-header bg-white border-0 py-3">
			<div class="d-flex align-items-center justify-content-between">
				<h5 class="mb-0"><i class="fas fa-list me-2"></i>Danh sách khách hàng</h5>
				<span class="badge bg-primary fs-6">@Model.Customers.Count khách hàng</span>
			</div>
		</div>
		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table table-hover align-middle mb-0">
					<thead class="table-light">
						<tr>
							<th class="ps-4">STT</th>
							<th>Thông tin khách hàng</th>
							<th>Liên hệ</th>
							<th>Địa chỉ</th>
							<th>Ngày đăng ký</th>
							<th>Trạng thái</th>
							<th class="text-center pe-4">Thao tác</th>
						</tr>
					</thead>
					<tbody>
						@if (Model.Customers.Count == 0)
						{
							<tr>
								<td colspan="7" class="text-center py-5 text-muted">
									<i class="fas fa-users fs-1 mb-3 d-block opacity-25"></i>
									<div>Chưa có khách hàng nào</div>
									<a asp-page="/DealerManager/Customers/Create" class="btn btn-sm btn-primary mt-3">
										<i class="fas fa-plus me-1"></i>Thêm khách hàng đầu tiên
									</a>
								</td>
							</tr>
						}
						@for (var i = 0; i < Model.Customers.Count; i++)
						{
							var customer = Model.Customers[i];
							var avatarColor = new[] { "primary", "success", "info", "warning", "danger", "secondary" }[i % 6];
							<tr>
								<td class="ps-4 fw-semibold text-muted">@(i + 1)</td>
								<td>
									<div class="d-flex align-items-center">
										<div class="avatar-circle bg-@avatarColor text-white me-3">
											@(string.IsNullOrEmpty(customer.FullName) ? "?" : customer.FullName.Substring(0, 1).ToUpper())
										</div>
										<div>
											<div class="fw-semibold">@customer.FullName</div>
											<small class="text-muted">ID: @customer.Id.ToString().Substring(0, 8).ToUpper()</small>
										</div>
									</div>
								</td>
								<td>
									<div class="mb-1">
										<i class="fas fa-phone text-primary me-2"></i>
										<a href="tel:@customer.PhoneNumber" class="text-decoration-none">@customer.PhoneNumber</a>
									</div>
									@if (!string.IsNullOrEmpty(customer.Email))
									{
										<div>
											<i class="fas fa-envelope text-info me-2"></i>
											<a href="mailto:@customer.Email" class="text-decoration-none">@customer.Email</a>
										</div>
									}
								</td>
								<td>
									<i class="fas fa-map-marker-alt text-danger me-2"></i>
									<span class="text-muted">@(string.IsNullOrEmpty(customer.Address) ? "Chưa cập nhật" : customer.Address)</span>
								</td>
								<td>
									<div class="d-flex align-items-center">
										<i class="fas fa-calendar text-muted me-2"></i>
										<span>@customer.CreatedAt.ToString("dd/MM/yyyy")</span>
									</div>
								</td>
								<td>
									<span class="badge bg-success-subtle text-success">
										<i class="fas fa-check-circle me-1"></i>Hoạt động
									</span>
								</td>
								<td class="text-center pe-4">
									<div class="btn-group" role="group">
										<a asp-page="/DealerManager/Customers/Detail" asp-route-id="@customer.Id" class="btn btn-sm btn-outline-primary" title="Xem chi tiết">
											<i class="fas fa-eye"></i>
										</a>
										<a asp-page="/DealerManager/Customers/Edit" asp-route-id="@customer.Id" class="btn btn-sm btn-outline-secondary" title="Chỉnh sửa">
											<i class="fas fa-edit"></i>
										</a>
										<a asp-page="/DealerManager/Orders/Create" asp-route-customerId="@customer.Id" class="btn btn-sm btn-outline-success" title="Tạo đơn hàng">
											<i class="fas fa-file-invoice"></i>
										</a>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
		@if (Model.Customers.Count > 0)
		{
			<div class="card-footer bg-white border-0 py-3">
				<div class="d-flex align-items-center justify-content-between">
					<div class="text-muted small">
						Hiển thị <strong>@Model.Customers.Count</strong> khách hàng
					</div>
					<nav aria-label="Customer pagination">
						<ul class="pagination pagination-sm mb-0">
							<li class="page-item disabled"><a class="page-link" href="#">Trước</a></li>
							<li class="page-item active"><a class="page-link" href="#">1</a></li>
							<li class="page-item"><a class="page-link" href="#">2</a></li>
							<li class="page-item"><a class="page-link" href="#">3</a></li>
							<li class="page-item"><a class="page-link" href="#">Sau</a></li>
						</ul>
					</nav>
				</div>
			</div>
		}
	</div>
</div>

<style>
	.avatar-circle {
		width: 45px;
		height: 45px;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: 700;
		font-size: 18px;
	}
	
	.table tbody tr {
		transition: background-color 0.2s ease;
	}
	
	.table tbody tr:hover {
		background-color: rgba(102, 126, 234, 0.05);
	}
</style>
