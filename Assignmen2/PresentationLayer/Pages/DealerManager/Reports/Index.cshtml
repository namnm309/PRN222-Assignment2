@page
@model PresentationLayer.Pages.DealerManager.Reports.IndexModel
@{
	Layout = "/Pages/Shared/_DashboardLayout.cshtml";
	ViewData["Title"] = "Báo cáo doanh số";
}

<div class="container-fluid">
	<!-- Header -->
	<div class="mb-4">
		<h3 class="fw-bold mb-1"><i class="fas fa-chart-line me-2 text-success"></i>Báo cáo doanh số</h3>
		<p class="text-muted mb-0">Phân tích doanh thu và hiệu suất bán hàng</p>
	</div>

	<!-- Filters Card -->
	<div class="card border-0 shadow-sm mb-4">
		<div class="card-header bg-white border-0 py-3">
			<h5 class="mb-0"><i class="fas fa-filter me-2"></i>Bộ lọc báo cáo</h5>
		</div>
		<div class="card-body">
			<form method="get" class="row g-3">
				<div class="col-md-2">
					<label class="form-label fw-semibold">
						<i class="fas fa-calendar-alt me-1"></i>Chu kỳ
					</label>
					<select class="form-select" asp-for="Period">
						<option value="monthly">Theo tháng</option>
						<option value="quarterly">Theo quý</option>
						<option value="yearly">Theo năm</option>
						<option value="custom">Tùy chỉnh</option>
					</select>
				</div>
				<div class="col-md-2">
					<label class="form-label fw-semibold">Năm</label>
					<input class="form-control" asp-for="Year" type="number" />
				</div>
				<div class="col-md-2">
					<label class="form-label fw-semibold">Tháng</label>
					<input class="form-control" asp-for="Month" type="number" min="1" max="12" />
				</div>
				<div class="col-md-2">
					<label class="form-label fw-semibold">Quý</label>
					<select class="form-select" asp-for="Quarter">
						<option value="">--</option>
						<option value="1">Q1</option>
						<option value="2">Q2</option>
						<option value="3">Q3</option>
						<option value="4">Q4</option>
					</select>
				</div>
				<div class="col-md-2">
					<label class="form-label fw-semibold">Từ ngày</label>
					<input type="date" class="form-control" asp-for="FromDate" />
				</div>
				<div class="col-md-2">
					<label class="form-label fw-semibold">Đến ngày</label>
					<input type="date" class="form-control" asp-for="ToDate" />
				</div>
				<div class="col-md-12 d-flex gap-2">
					<button class="btn btn-primary" type="submit">
						<i class="fas fa-filter me-1"></i>Áp dụng bộ lọc
					</button>
					<a asp-page="/DealerManager/Reports/Index" class="btn btn-outline-secondary">
						<i class="fas fa-sync me-1"></i>Làm mới
					</a>
					<button class="btn btn-outline-success" type="button">
						<i class="fas fa-file-excel me-1"></i>Xuất Excel
					</button>
				</div>
			</form>
		</div>
	</div>

	<!-- KPI Cards -->
	<div class="row g-3 mb-4">
		<div class="col-md-6">
			<div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
				<div class="card-body text-white">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<div class="small opacity-75 mb-2">Tổng doanh số (chu kỳ)</div>
							<h2 class="mb-0 fw-bold">@Model.CurrentTotal.ToString("N0")</h2>
							<div class="small mt-2 opacity-75">VND</div>
						</div>
						<div class="p-3 bg-white bg-opacity-25 rounded-circle">
							<i class="fas fa-chart-line fs-1"></i>
						</div>
					</div>
					<div class="progress mt-3" style="height: 6px;">
						<div class="progress-bar bg-white" style="width: 75%"></div>
					</div>
					<div class="small mt-2 opacity-75">
						<i class="fas fa-arrow-up me-1"></i>So với kỳ trước
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6">
			<div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
				<div class="card-body text-white">
					<div class="d-flex justify-content-between align-items-center">
						<div>
							<div class="small opacity-75 mb-2">Doanh số năm nay</div>
							<h2 class="mb-0 fw-bold">@Model.YearTotal.ToString("N0")</h2>
							<div class="small mt-2 opacity-75">VND</div>
						</div>
						<div class="p-3 bg-white bg-opacity-25 rounded-circle">
							<i class="fas fa-calendar-check fs-1"></i>
						</div>
					</div>
					<div class="progress mt-3" style="height: 6px;">
						<div class="progress-bar bg-white" style="width: 88%"></div>
					</div>
					<div class="small mt-2 opacity-75">
						<i class="fas fa-trophy me-1"></i>Mục tiêu năm
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Tables Row -->
	<div class="row g-3">
		<!-- Top Employees -->
		<div class="col-lg-6">
			<div class="card border-0 shadow-sm">
				<div class="card-header bg-white border-0 py-3">
					<h5 class="mb-0"><i class="fas fa-user-tie me-2 text-primary"></i>Top nhân viên bán hàng</h5>
				</div>
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table table-hover align-middle mb-0">
							<thead class="table-light">
								<tr>
									<th class="ps-4">Xếp hạng</th>
									<th>Nhân viên</th>
									<th class="text-end">Doanh số</th>
									<th class="text-center pe-4">Đơn hàng</th>
								</tr>
							</thead>
							<tbody>
								@if (Model.TopEmployees == null || !Model.TopEmployees.Any())
								{
									<tr>
										<td colspan="4" class="text-center py-4 text-muted">
											<i class="fas fa-user-slash fs-3 mb-2 d-block opacity-25"></i>
											Chưa có dữ liệu
										</td>
									</tr>
								}
								else
								{
									@for (var i = 0; i < Model.TopEmployees.Count && i < 5; i++)
									{
										var emp = Model.TopEmployees[i];
										var rankColor = i switch {
											0 => "warning",
											1 => "secondary",
											2 => "danger",
											_ => "primary"
										};
										var rankIcon = i switch {
											0 => "fa-trophy",
											1 => "fa-medal",
											2 => "fa-award",
											_ => "fa-star"
										};
										<tr>
											<td class="ps-4">
												<div class="d-flex align-items-center">
													<div class="badge bg-@rankColor-subtle text-@rankColor me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-size: 16px;">
														<i class="fas @rankIcon"></i>
													</div>
													<strong>#@(i + 1)</strong>
												</div>
											</td>
											<td>
												<div class="d-flex align-items-center">
													<div class="avatar-circle bg-primary text-white me-2">
														@(string.IsNullOrEmpty(emp.EmployeeName) ? "?" : emp.EmployeeName.Substring(0, 1).ToUpper())
													</div>
													<div>
														<div class="fw-semibold">@emp.EmployeeName</div>
														<small class="text-muted">@emp.EmployeeId.ToString().Substring(0, 8).ToUpper()</small>
													</div>
												</div>
											</td>
											<td class="text-end">
												<div class="fw-bold text-success">@emp.TotalSales.ToString("N0")</div>
												<small class="text-muted">VND</small>
											</td>
											<td class="text-center pe-4">
												<span class="badge bg-primary-subtle text-primary">@emp.OrderCount</span>
											</td>
										</tr>
									}
								}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- Top Vehicles -->
		<div class="col-lg-6">
			<div class="card border-0 shadow-sm">
				<div class="card-header bg-white border-0 py-3">
					<h5 class="mb-0"><i class="fas fa-car me-2 text-success"></i>Top xe bán chạy</h5>
				</div>
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table table-hover align-middle mb-0">
							<thead class="table-light">
								<tr>
									<th class="ps-4">Xếp hạng</th>
									<th>Sản phẩm</th>
									<th class="text-end">Doanh số</th>
									<th class="text-center pe-4">Số lượng</th>
								</tr>
							</thead>
							<tbody>
								@if (Model.TopVehicles == null || !Model.TopVehicles.Any())
								{
									<tr>
										<td colspan="4" class="text-center py-4 text-muted">
											<i class="fas fa-car-slash fs-3 mb-2 d-block opacity-25"></i>
											Chưa có dữ liệu
										</td>
									</tr>
								}
								else
								{
									@for (var i = 0; i < Model.TopVehicles.Count && i < 5; i++)
									{
										var vehicle = Model.TopVehicles[i];
										var rankColor = i switch {
											0 => "warning",
											1 => "secondary",
											2 => "danger",
											_ => "success"
										};
										<tr>
											<td class="ps-4">
												<div class="d-flex align-items-center">
													<div class="badge bg-@rankColor-subtle text-@rankColor me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-size: 16px;">
														#@(i + 1)
													</div>
												</div>
											</td>
											<td>
												<div>
													<div class="fw-semibold">@vehicle.ProductName</div>
													<small class="text-muted">SKU: @vehicle.ProductSku</small>
												</div>
											</td>
											<td class="text-end">
												<div class="fw-bold text-success">@vehicle.TotalSales.ToString("N0")</div>
												<small class="text-muted">VND</small>
											</td>
											<td class="text-center pe-4">
												<span class="badge bg-success-subtle text-success">@vehicle.QuantitySold</span>
											</td>
										</tr>
									}
								}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.avatar-circle {
		width: 35px;
		height: 35px;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: 700;
		font-size: 14px;
	}
	
	.table tbody tr {
		transition: background-color 0.2s ease;
	}
	
	.table tbody tr:hover {
		background-color: rgba(102, 126, 234, 0.05);
	}
</style>
