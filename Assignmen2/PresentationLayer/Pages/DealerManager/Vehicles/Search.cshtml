@page
@model PresentationLayer.Pages.DealerManager.Vehicles.SearchModel
@{
	Layout = "/Pages/Shared/_DashboardLayout.cshtml";
	ViewData["Title"] = "Tra cứu xe";
}

<div class="container-fluid">
	<!-- Header -->
	<div class="mb-4">
		<h3 class="mb-1 fw-bold"><i class="fas fa-search me-2 text-primary"></i>Tra cứu xe</h3>
		<p class="text-muted mb-0">Tìm kiếm và xem thông tin sản phẩm</p>
	</div>

	<!-- Search Form -->
	<form method="get">
		<div class="card border-0 shadow-sm mb-4">
			<div class="card-body">
				<div class="row g-3">
					<div class="col-lg-3 col-md-6">
						<label class="form-label small fw-semibold">
							<i class="fas fa-search me-1"></i>Từ khóa
						</label>
						<input class="form-control" name="Q" value="@Model.Q" placeholder="Nhập tên xe, SKU..." />
					</div>
					<div class="col-lg-3 col-md-6">
						<label class="form-label small fw-semibold">
							<i class="fas fa-copyright me-1"></i>Thương hiệu
						</label>
						<select class="form-select" name="BrandId">
							<option value="">Tất cả thương hiệu</option>
							@foreach (var b in Model.Brands)
							{
								<option value="@b.Id" selected="@(Model.BrandId == b.Id)">@b.Name</option>
							}
						</select>
					</div>
					<div class="col-lg-2 col-md-6">
						<label class="form-label small fw-semibold">
							<i class="fas fa-money-bill me-1"></i>Giá từ (VND)
						</label>
						<input class="form-control" name="MinPrice" value="@Model.MinPrice" type="number" placeholder="0" />
					</div>
					<div class="col-lg-2 col-md-6">
						<label class="form-label small fw-semibold">Giá đến (VND)</label>
						<input class="form-control" name="MaxPrice" value="@Model.MaxPrice" type="number" placeholder="10,000,000,000" />
					</div>
					<div class="col-lg-2 align-self-end">
						<button class="btn btn-primary w-100" type="submit">
							<i class="fas fa-search me-1"></i>Tìm kiếm
						</button>
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-12">
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="checkbox" name="InStock" value="true" id="inStock" checked="@(Model.InStock == true)" />
							<label class="form-check-label" for="inStock">
								<i class="fas fa-box-open me-1"></i>Chỉ hiển thị xe còn hàng
							</label>
						</div>
						<a class="btn btn-sm btn-outline-secondary ms-2" asp-page="/DealerManager/Vehicles/Search">
							<i class="fas fa-sync me-1"></i>Làm mới
						</a>
					</div>
				</div>
			</div>
		</div>
	</form>

	<!-- Results Summary -->
	@if (Model.Products.Count > 0)
	{
		<div class="d-flex align-items-center justify-content-between mb-3">
			<div>
				<span class="text-muted">Tìm thấy</span>
				<strong class="text-primary">@Model.Products.Count</strong>
				<span class="text-muted">sản phẩm</span>
			</div>
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-sm btn-outline-secondary active">
					<i class="fas fa-th me-1"></i>Lưới
				</button>
				<button type="button" class="btn btn-sm btn-outline-secondary">
					<i class="fas fa-list me-1"></i>Danh sách
				</button>
			</div>
		</div>
	}

	<!-- Products Grid -->
	<div class="row g-4">
		@if (Model.Products.Count == 0)
		{
			<div class="col-12">
				<div class="card border-0 shadow-sm">
					<div class="card-body text-center py-5">
						<i class="fas fa-car fs-1 text-muted opacity-25 mb-3"></i>
						<h5 class="text-muted">Không tìm thấy sản phẩm nào</h5>
						<p class="text-muted mb-3">Vui lòng thử lại với từ khóa hoặc bộ lọc khác</p>
						<a asp-page="/DealerManager/Vehicles/Search" class="btn btn-primary">
							<i class="fas fa-sync me-1"></i>Tìm kiếm lại
						</a>
					</div>
				</div>
			</div>
		}
		@foreach (var p in Model.Products)
		{
			<div class="col-lg-4 col-md-6">
				<div class="card border-0 shadow-sm h-100 product-card">
					<div class="position-relative">
						<img src="@(string.IsNullOrEmpty(p.ImageUrl) ? "https://via.placeholder.com/400x250/667eea/ffffff?text=" + Uri.EscapeDataString(p.Name) : p.ImageUrl)" 
							 class="card-img-top" alt="@p.Name" style="height: 220px; object-fit: cover;" />
						@if (p.StockQuantity > 0)
						{
							<span class="badge bg-success position-absolute top-0 end-0 m-3">
								<i class="fas fa-check-circle me-1"></i>Còn hàng
							</span>
						}
						else
						{
							<span class="badge bg-danger position-absolute top-0 end-0 m-3">
								<i class="fas fa-times-circle me-1"></i>Hết hàng
							</span>
						}
					</div>
					<div class="card-body d-flex flex-column">
						<div class="mb-2">
							<span class="badge bg-primary-subtle text-primary">@(p.Brand?.Name ?? "N/A")</span>
							<span class="badge bg-secondary-subtle text-secondary">SKU: @p.Sku</span>
						</div>
						<h5 class="card-title mb-2">@p.Name</h5>
						@if (!string.IsNullOrWhiteSpace(p.Description))
						{
							<p class="card-text text-muted small flex-grow-1">
								@p.Description.Substring(0, Math.Min(100, p.Description.Length))@(p.Description.Length > 100 ? "..." : "")
							</p>
						}
						<div class="mt-auto">
							<div class="d-flex align-items-center justify-content-between mb-3">
								<div>
									<div class="text-primary fw-bold fs-4">@p.Price.ToString("N0")</div>
									<small class="text-muted">VND</small>
								</div>
								<div class="text-end">
									<small class="text-muted d-block">Tồn kho</small>
									<span class="badge @(p.StockQuantity > 10 ? "bg-success" : p.StockQuantity > 0 ? "bg-warning" : "bg-danger")">
										@p.StockQuantity
									</span>
								</div>
							</div>
							<div class="d-grid gap-2">
								<button class="btn btn-primary btn-sm">
									<i class="fas fa-info-circle me-1"></i>Chi tiết
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		}
	</div>

	<!-- Pagination -->
	@if (Model.Products.Count > 0)
	{
		<div class="mt-4">
			<nav aria-label="Product pagination">
				<ul class="pagination justify-content-center mb-0">
					<li class="page-item disabled"><a class="page-link" href="#">Trước</a></li>
					<li class="page-item active"><a class="page-link" href="#">1</a></li>
					<li class="page-item"><a class="page-link" href="#">2</a></li>
					<li class="page-item"><a class="page-link" href="#">3</a></li>
					<li class="page-item"><a class="page-link" href="#">Sau</a></li>
				</ul>
			</nav>
		</div>
	}
</div>

<style>
	.product-card {
		transition: transform 0.3s ease, box-shadow 0.3s ease;
		overflow: hidden;
	}
	
	.product-card:hover {
		transform: translateY(-8px);
		box-shadow: 0 0.5rem 2rem rgba(0,0,0,0.15) !important;
	}
	
	.product-card img {
		transition: transform 0.3s ease;
	}
	
	.product-card:hover img {
		transform: scale(1.05);
	}
</style>
